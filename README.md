# README

## Структура проекта

```
.
├── README.md
├── source_data/          # Исходные данные для анализа
├── output_data/          # Результаты выполнения задач 1 и 2
├── task1.ipynb          # Задача 1: Расчет цен и скидок
├── task2.ipynb          # Задача 2: Оптимизация скидок через эластичность
├── task3.ipynb          # Задача 3: Анализ маржинальности по неделям
├── task4.ipynb          # Задача 4: Анатилические ad hoc SQL запросы
└── task5.ipynb          # Задача 5: Расчет WAU по активности пользователей
```

## Задача 1
[task1.ipynb](task1.ipynb)

Рассчитываем базовую цену товара от закупки по справочнику наценок (`base_price`). Далее выбираем целевую конкурентную позицию по цене с приоритетом: быть дешевле минимальной цены рынка (`min-1`), затем дешевле 2-й и 3-й цены (топ-2/топ-3). Скидка задаётся целым процентом (округление вверх), итоговая цена получается из скидки и проверяется на ограничение маржинальности не ниже 10%. Если из-за округления скидки маржа падает ниже 10%, скидка уменьшается на 1 п.п. Для позиций, которые не удаётся вывести в топ-3 по цене при марже ≥10%, ставится минимальная допустимая цена `ceil(cost/0.9)` без изменения наценки.

---

## Задача 2
[task2.ipynb](task2.ipynb)

Оптимизация скидок через моделирование эластичности спроса по цене. Построена логарифмическая модель:
`ln(sales) = a + b * ln(price)`, где `b` — эластичность. На её основе оценивается, какая цена/скидка нужна, чтобы достичь целевого роста продаж(x2).

---

## Задача 3
[task3.ipynb](task3.ipynb)

Анализ продаж **в разрезе брендов** за позапрошлую (14) и прошлую (15) недели. Рассчитаны выручка, валовая прибыль и маржинальность по брендам и в целом. Сформирована короткая аналитическая записка: какие бренды дали основной вклад в изменение выручки/маржинальности и какие факторы могли повлиять. Также предложено действие, которое может дать быстрый эффект.

---

## Задача 4
[task4.ipynb](task4.ipynb)

Ad hoc SQL (ClickHouse) по продажам.

1) Для каждого товара (только товары с продажами за последний полный месяц) рассчитаны:
- продажи в штуках и в рублях за последний полный месяц
- средняя цена за последний полный месяц
- средний объем продаж (шт) за последние 3 месяца (включая последний)
- разница между текущим остатком и средним объемом продаж за 3 месяца

2) Выведен топ-5 брендов по объему продаж (руб) за последний полный месяц и сравнение с предыдущим месяцем:
- продажи за месяц (rub_m1), продажи за прошлый месяц (rub_m2)
- абсолютная и относительная разница (diff_rub, pct_change)

Месяцы определяются динамически через `toStartOfMonth(today())` и `addMonths`.

---

## Задача 5
[task5.ipynb](task5.ipynb)

Расчет Weekly Active Users (WAU) в SQL (ClickHouse) как числа уникальных пользователей, активных в скользящем окне 7 дней (текущий день + предыдущие 6).

Реализация:
- формируется набор уникальных пар (day, user_id)
- через `ARRAY JOIN range(7)` каждый пользовательский день “размножается” на 7 дат окна
- далее считается `uniqExact(user_id)` по каждой дате `dt`

Дополнительно выводятся границы окна: `start_date = dt - 6`, `end_date = dt`.

---